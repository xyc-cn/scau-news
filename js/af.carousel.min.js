(function(e){function s(e,t){var n=e,r=t,i=Math.round(Math.sqrt(Math.pow(n,2)+Math.pow(r,2))),s=Math.atan2(r,n),o=Math.round(s*180/Math.PI);return o<0&&(o=360-Math.abs(o)),o<=215&&o>=155||o<=45&&o>=0||o<=360&&o>=315?!0:!1}var t=[],r=function(t){return t.afmCarouselId||(t.afmCarouselId=e.uuid()),t.afmCarouselId};e.fn.carousel=function(e){var n,s;for(var o=0;o<this.length;o++)s=r(this[o]),t[s]?n=t[s]:(n=new i(this[o],e),t[s]=n);return this.length==1?n:this};var i=function(){var r=e.feat.cssTransformStart,i=e.feat.cssTransformEnd,o=function(n,r){typeof n=="string"||n instanceof String?this.container=document.getElementById(n):this.container=n;if(!this.container){alert("Error finding container for carousel "+n);return}if(!(this instanceof o))return new o(n,r);for(var i in r)r.hasOwnProperty(i)&&(this[i]=r[i]);var s=this;af(this.container).bind("destroy",function(e){var n=s.container.afmCarouselId;window.removeEventListener("orientationchange",s.orientationHandler,!1),t[n]&&delete t[n],e.stopPropagation()}),this.pagingDiv=this.pagingDiv?document.getElementById(this.pagingDiv):null,this.container.style.overflow="hidden",this.vertical&&(this.horizontal=!1);var u=document.createElement("div");this.container.appendChild(u);var a=e(u),f=e(this.container),l=Array.prototype.slice.call(this.container.childNodes);while(l.length>0){var c=l.splice(0,1);c=f.find(c);if(c.get()==u)continue;a.append(c.get())}this.horizontal?(u.style.display="block",u.style["float"]="left"):u.style.display="block",this.el=u,this.refreshItems();var h=af(u);h.bind("touchmove",function(e){s.touchMove(e)}),h.bind("touchend",function(e){s.touchEnd(e)}),h.bind("touchstart",function(e){s.touchStart(e)}),this.orientationHandler=function(){s.onMoveIndex(s.carouselIndex,0)},window.addEventListener("orientationchange",this.orientationHandler,!1)};return o.prototype={wrap:!0,startX:0,startY:0,dx:0,dy:0,glue:!1,myDivWidth:0,myDivHeight:0,cssMoveStart:0,childrenCount:0,carouselIndex:0,vertical:!1,horizontal:!0,el:null,movingElement:!1,container:null,pagingDiv:null,pagingCssName:"carousel_paging",pagingCssNameSelected:"carousel_paging_selected",pagingFunction:null,lockMove:!1,okToMove:!1,touchStart:function(t){this.okToMove=!1,this.myDivWidth=numOnly(this.container.clientWidth),this.myDivHeight=numOnly(this.container.clientHeight),this.lockMove=!1;if(t.touches[0].target&&t.touches[0].target.type!==undefined){var n=t.touches[0].target.tagName.toLowerCase();if(n==="select"||n==="input"||n==="button")return}if(t.touches.length===1){this.movingElement=!0,this.startY=t.touches[0].pageY,this.startX=t.touches[0].pageX;var r=e.getCssMatrix(this.el);if(this.vertical)try{this.cssMoveStart=numOnly(r.f)}catch(i){this.cssMoveStart=0}else try{this.cssMoveStart=numOnly(r.e)}catch(i){this.cssMoveStart=0}}},touchMove:function(t){if(!this.movingElement)return;if(t.touches.length>1)return this.touchEnd(t);var n={x:t.touches[0].pageX-this.startX,y:t.touches[0].pageY-this.startY};if(this.vertical){var r={x:0,y:0};this.dy=t.touches[0].pageY-this.startY,this.dy+=this.cssMoveStart,r.y=this.dy,t.preventDefault()}else{if(!(!this.lockMove&&s(n.x,n.y)||Math.abs(this.dx)>5))return this.lockMove=!0;var r={x:0,y:0};this.dx=t.touches[0].pageX-this.startX,this.dx+=this.cssMoveStart,t.preventDefault(),r.x=this.dx}var i=this.vertical?this.dy%this.myDivHeight/this.myDivHeight*100*-1:this.dx%this.myDivWidth/this.myDivWidth*100*-1;this.okToMove||(oldStateOkToMove=this.okToMove,this.okToMove=this.glue?Math.abs(i)>this.glue&&Math.abs(i)<100-this.glue:!0,this.okToMove&&!oldStateOkToMove&&e.trigger(this,"movestart",[this.el])),this.okToMove&&r&&this.moveCSS3(this.el,r)},touchEnd:function(t){if(!this.movingElement)return;e.trigger(this,"movestop",[this.el]);var n=!1,r=e.getCssMatrix(this.el),i=this.vertical?numOnly(r.f):numOnly(r.e),s=this.vertical?this.dy%this.myDivHeight/this.myDivHeight*100*-1:this.dx%this.myDivWidth/this.myDivWidth*100*-1,o=this.carouselIndex;i<this.cssMoveStart&&s>3?o++:i>this.cssMoveStart&&s<97&&o--;var u=o;this.wrap?(o>this.childrenCount-1&&(o=0,u=this.childrenCount),o<0&&(o=this.childrenCount-1,u=-1)):(o<0&&(o=0),o>this.childrenCount-1&&(o=this.childrenCount-1),u=o);var a={x:0,y:0};this.vertical?a.y=u*this.myDivHeight*-1:a.x=u*this.myDivWidth*-1,this.moveCSS3(this.el,a,"150"),this.pagingDiv&&this.carouselIndex!==o&&(document.getElementById(this.container.id+"_"+this.carouselIndex).className=this.pagingCssName,document.getElementById(this.container.id+"_"+o).className=this.pagingCssNameSelected),this.carouselIndex!=o&&(n=!0),this.carouselIndex=o;if(this.wrap&&u!=o){var f=this;window.setTimeout(function(){f.onMoveIndex(o,"1ms")},155)}this.dx=0,this.movingElement=!1,this.startX=0,this.dy=0,this.startY=0,n&&this.pagingFunction&&typeof this.pagingFunction=="function"&&this.pagingFunction(this.carouselIndex)},onMoveIndex:function(e,t){this.myDivWidth=numOnly(this.container.clientWidth),this.myDivHeight=numOnly(this.container.clientHeight);var n=!1;document.getElementById(this.container.id+"_"+this.carouselIndex)&&(document.getElementById(this.container.id+"_"+this.carouselIndex).className=this.pagingCssName);var r=Math.abs(e-this.carouselIndex),i=e;i<0&&(i=0),i>this.childrenCount-1&&(i=this.childrenCount-1);var s={x:0,y:0};this.vertical?s.y=i*this.myDivHeight*-1:s.x=i*this.myDivWidth*-1;var o=t?t:50+parseInt(r*20);this.moveCSS3(this.el,s,o),this.carouselIndex!=i&&(n=!0),this.carouselIndex=i;if(this.pagingDiv){var u=document.getElementById(this.container.id+"_"+this.carouselIndex);u&&(u.className=this.pagingCssNameSelected)}n&&this.pagingFunction&&typeof this.pagingFunction=="function"&&this.pagingFunction(currInd)},moveCSS3:function(t,n,s,o){s?s=parseInt(s):s=0,o||(o="linear"),t.style[e.feat.cssPrefix+"Transform"]="translate"+r+n.x+"px,"+n.y+"px"+i,t.style[e.feat.cssPrefix+"TransitionDuration"]=s+"ms",t.style[e.feat.cssPrefix+"BackfaceVisibility"]="hidden",t.style[e.feat.cssPrefix+"TransformStyle"]="preserve-3d",t.style[e.feat.cssPrefix+"TransitionTimingFunction"]=o},addItem:function(e){e&&e.nodeType&&(this.container.childNodes[0].appendChild(e),this.refreshItems())},refreshItems:function(){var t=0,r=this,i=this.el;e(i).children().find(".prevBuffer").remove(),e(i).children().find(".nextBuffer").remove(),n=i.childNodes[0];var s,o="100%",u=[];for(;n;n=n.nextSibling)n.nodeType===1&&(u.push(n),t++);if(this.wrap){var a=e(u[u.length-1]).clone().get(0);e(i).prepend(a);var f=e(u[0]).clone().get(0);e(i).append(f),u.push(f),u.unshift(a),f.style.position="absolute",a.style.position="absolute"}var l=100/t+"%";this.childrenCount=t,s=parseFloat(100/t)+"%";for(var c=0;c<u.length;c++)this.horizontal?(u[c].style.width=s,u[c].style.height="100%",u[c].style["float"]="left"):(u[c].style.height=s,u[c].style.width="100%",u[c].style.display="block");this.moveCSS3(i,{x:0,y:0}),this.horizontal?(i.style.width=Math.ceil(this.childrenCount*100)+"%",i.style.height="100%",i.style["min-height"]="100%",this.wrap&&(a.style.left="-"+s,f.style.left="100%")):(i.style.width="100%",i.style.height=Math.ceil(this.childrenCount*100)+"%",i.style["min-height"]=Math.ceil(this.childrenCount*100)+"%",this.wrap&&(a.style.top="-"+s,f.style.top="100%"));if(this.pagingDiv){this.pagingDiv.innerHTML="";for(c=0;c<this.childrenCount;c++){var h=document.createElement("div");h.id=this.container.id+"_"+c,h.pageId=c,c!==this.carouselIndex?h.className=this.pagingCssName:h.className=this.pagingCssNameSelected,h.onclick=function(){r.onMoveIndex(this.pageId)};var p=document.createElement("div");p.style.width="20px",this.horizontal?(p.style.display="inline-block",p.innerHTML="&nbsp;"):(p.innerHTML="&nbsp;",p.style.display="block"),this.pagingDiv.appendChild(h),c+1<this.childrenCount&&this.pagingDiv.appendChild(p),h=null,p=null}this.horizontal?(this.pagingDiv.style.width=this.childrenCount*50+"px",this.pagingDiv.style.height="25px"):(this.pagingDiv.style.height=this.childrenCount*50+"px",this.pagingDiv.style.width="25px")}this.onMoveIndex(this.carouselIndex)}},o}()})(af)